**Errata** (2 items)

If you find any mistakes, then please [raise an issue in this repository](https://github.com/markjprice/apps-services-net7/issues) or email me at markjprice (at) gmail.com.

> Microsoft has changed their domain for documentation from `https://docs.microsoft.com` to `https://learn.microsoft.com` with an automatic redirect so all links in my books that use the `docs` domain should still work.

- [Page 56 - Managing data with Transact-SQL](#page-56---managing-data-with-transact-sql)
- [Page 82 - Defining the Northwind database model](#page-82---defining-the-northwind-database-model)
  - [Category class changes](#category-class-changes)
  - [NorthwindDb class changes](#northwinddb-class-changes)

# Page 56 - Managing data with Transact-SQL

The link to the SQL language reference is broken in the PDF version due to a line break. It should be: 
https://learn.microsoft.com/en-us/sql/t-sql/language-reference.

# Page 82 - Defining the Northwind database model

> Thanks to [Bob Molloy](https://github.com/BobMolloy) for raising this [issue on 31 December 2022](https://github.com/markjprice/apps-services-net7/issues/5).

## Category class changes

In Step 7, I show the class that represents a `Category` in the Northwind database that is generated by the `dotnet-ef`, as shown in the following code:
```cs
using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;
using Microsoft.EntityFrameworkCore;

namespace Northwind.Console.EFCore.Models
{
  [Index("CategoryName", Name = "CategoryName")]
  public partial class Category
  {
    public Category()
    {
      Products = new HashSet<Product>();
    }

    [Key]
    public int CategoryId { get; set; }

    [StringLength(15)]
    public string CategoryName { get; set; } = null!;

    [Column(TypeName = "ntext")]
    public string? Description { get; set; }

    [Column(TypeName = "image")]
    public byte[]? Picture { get; set; }

    [InverseProperty("Category")]
    public virtual ICollection<Product> Products { get; set; }
  }
}
```
The current `dotnet-ef` tool generates slightly different output, for example, it uses a file-scoped namespace declaration to avoid indenting and it initializes the `Products` property to a `List<T>` instead of a `HashSet<T>`, as shown in the following code:
```cs
using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;
using Microsoft.EntityFrameworkCore;

namespace Northwind.Console.EFCore.Models;

[Index("CategoryName", Name = "CategoryName")]
public partial class Category
{
  [Key]
  public int CategoryId { get; set; }

  [StringLength(15)]
  public string CategoryName { get; set; } = null!;

  [Column(TypeName = "ntext")]
  public string? Description { get; set; }

  [Column(TypeName = "image")]
  public byte[]? Picture { get; set; }

  [InverseProperty("Category")]
  public virtual ICollection<Product> Products { get; } = new List<Product>();
}
```

## NorthwindDb class changes

In Step 9, I show the class that represents the Northwind database that was generated by the `dotnet-ef` tool. The current `dotnet-ef` tool generates slightly different output, for example, it uses a file-scoped namespace declaration to avoid indenting and it does not set each `DbSet<T>` property to the null-forgiving operator, as shown in the following code:
```cs
// older version of dotnet-ef did this:
public virtual DbSet<Category> Categories { get; set; } = null!;

// current version of dotnet-ef does this:
public virtual DbSet<Category> Categories { get; set; }
```

We asked the compiler to treat warnings as errors so we cannot build until the compiler knows that all those 25+ properties are safe to use as `null`. We could manually add the null-forgiving operator, or use a find and replace regular expression to do it, or customize the T4 template used by the `dotnet-ef` tool to set all `DbSet<T>` properties to the null-forgiving operator, but the easiest thing to do is simply disable null warnings for this file by adding the following statement to the top of the class file, as shown in the following code:
```cs
#nullable disable
```

Microsoft recommends either setting `DbSet<T>` properties to the null-forgiving operator, or calling the `Set<T>` method defined in the `DbContext` base class to implement them as a read-only property, as shown in the following code:
```cs
public virtual DbSet<Category> Categories => Set<Category>();
```

**Working with Nullable Reference Types - DbContext and DbSet**
https://learn.microsoft.com/en-us/ef/core/miscellaneous/nullable-reference-types#dbcontext-and-dbset

> Thanks to [charlygg](https://github.com/charlygg) for suggesting using the `Set<T>` method in a comment on [issue on 1 January 2023](https://github.com/markjprice/apps-services-net7/issues/5#issuecomment-1368614033).